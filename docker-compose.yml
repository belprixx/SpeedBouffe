version: '3'
services:
  mysql:
    image: mysql:5.5.59
    container_name: mysql
    command: --max_allowed_packet=100M
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - TZ=Europe/Paris
      - MYSQL_DATABASE=command
      - MYSQL_USER=cmd
      - MYSQL_PASSWORD=cmd
    ports:
      - 3307:3306
    networks:
      - mysql-symfony
   
#  sailsjs:
#    build: image/sailsjs
#    volumes:
#      - ./:/root/speedbouffe
#    ports:
#      - 1337:1337
#    depends_on:
#      - db

  webserver:
      depends_on:
          - php-fpm
      image: nginx:alpine
      container_name: http-nginx-speedBouffe
      environment:
          - TZ=Europe/Paris
      working_dir: /application
      volumes:
          - ./symfony/speedBouffe:/application
          - ./symfony/nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      ports:
          - 8000:80
      networks:
          - nginx-symfony

  php-fpm:
     depends_on:
       - mysql
     build: symfony/php-fpm
     container_name: symfony-api-speedBouffe
     environment:
         - TZ=Europe/Paris
     working_dir: /application
     volumes:
         - ./symfony/speedBouffe:/application
         - ./symfony/php-fpm/php-ini-overrides.ini:/etc/php/7.2/fpm/conf.d/99-overrides.ini
     networks:
         - mysql-symfony
         - nginx-symfony
     command: /scripts/entrypoint.sh

networks:

  nginx-symfony:
    driver: bridge

  mysql-symfony:
     driver: bridge
